<html>                                                                  
<head>                                                                  
<meta name="viewport" content="width=device-width, initial-scale=1" /> 
<link rel="stylesheet" href="style.css" />
<script type="text/javascript" src="jq.js"></script>
<script type="text/javascript" src="jqm-settings.js"></script>
<script type="text/javascript" src="jqm.js"></script>
<script type="text/javascript">
<!--
var X = [
    { 
        icon: "/usr/share/icons/BlankOn/categories/scalable/gnome-system.svg",
        name: "Graphics",
        children: [
            {
                icon: "/usr/share/icons/hicolor/48x48/apps/gimp.png",
                name: "Gimp Image Editor"
            },
            {
                icon: "/usr/share/icons/hicolor/48x48/apps/inkscape.png",
                name: "Editor Grafis Inkscape"
            },
            {
                icon: "/usr/share/icons/hicolor/48x48/apps/libreoffice-draw.png",
                name: "Libre Office Draw"
            },
            {
                icon: "/usr/share/icons/BlankOn/apps/scalable/shotwell.svg",
                name: "Shotwell Photo Manager"
            },
            {
                icon: "/usr/share/icons/BlankOn/devices/scalable/scanner.svg",
                name: "Simple Scan"
            }
        ]
     }
];


var DataChanged = 1;


function inherit() {
    var superclasses = [];

    if (arguments.length < 2) {
        throw new Error("At least one object must be specified to be inherited from another");
    }

    var subclass   = arguments[0];
    var superclass = arguments[1];
    var t = function() {};
    t.prototype = superclass.prototype;
    subclass.prototype = new t();
    subclass.prototype.constructor = subclass;
    subclass.superclass = superclass.prototype;
}

function EventClass() {
    this.connections = {};
}

EventClass.prototype.constructor = EventClass;
EventClass.prototype.connect = function(type, obj, callback) {
    if (typeof this.connections == "undefined") {
        this.connections = {};
    }

    if (typeof this.connections[type] == "undefined") {
        this.connections[type] = [];
    }
    var c = { obj: obj, callback: callback }
    this.connections[type].push(c);
}

EventClass.prototype.emit = function(event) {
    if (typeof event == "number") {
        event = { type: event, target: this };
    }
    if (this.connections[event.type] instanceof Array) {
        for (var i = 0; i < this.connections[event.type].length; i ++) {
            var c = this.connections[event.type][i];
            c.callback.call(c.obj, event);
        }
    }
}


function XdgData() {
    this.data = {};
    this.data = X;
    this.dataReady = true;
}
inherit(XdgData, EventClass);

XdgData.prototype.set = function(value) {
    this.emit(DataChanged);
}

XdgData.prototype.constructor = XdgData;


/* XdgList */
function XdgList(data) {
    if (!(data instanceof XdgData)) {
        throw new Error("XdgList requires an XdgData to be attached");
    }
    this.data = data;
}
XdgList.prototype.constructor = XdgList;

XdgList.prototype.dataChanged = function(event) {
    console.log("dataChanged: " + this.element);
    this.render();
}

XdgList.prototype.attach = function(id) {
    var e = $("#" + id); 
    if (e.length == 0) {
        throw new Error("XdgList can't be attached to non-existence element");
    }
    this.element = "#" + id;
    this.data.connect(DataChanged, this, this.dataChanged); 
    if (this.data.dataReady) {
        this.render();
    }
}

XdgList.prototype.render = function() {
    $(this.element).empty();

    for (var j = 0; j < this.data.data.length; j ++) {
        var entry = this.data.data[j];
        var $div = $("<div/>", {
                     "data-role": "collapsible",
                     "data-iconpos": "right"
                   });
        var $h3  = $("<h3/>", {
                     "text": entry.name
                   });
        var $img = $("<img/>", {
                     "width": 24,
                     "height": 24,
                     "src": entry.icon,
                   });

        $div.append($h3);
        $(this.element).append($div);

        if (typeof entry.children != "undefined") {
            $ul = $("<ul/>", {
                    "data-role": "listview"
                   });
            for (var i = 0; i < entry.children.length; i ++) {
                var $li  = $("<li/>", { "data-icon": "false" });
                var $a   = $("<a/>", {
                                "href": "",
                                "text": entry.children[i].name
                            }).bind("tap", function (event, ui) {
                                console.log("tap");
                            });
                var $img = $("<img/>", {
                                "width": 24,
                                "height": 24,
                                "src": entry.children[i].icon,
                                "class": "ui-li-icon ui-li-thumb"
                            });
                $li.append($a);
                $a.append($img);
                $ul.append($li);
            }
            $div.append($ul);
        } 
    }
    console.log($(this.element));
    //$(this.element).trigger("create");
}


$(document).ready(function() {
    var data = new XdgData();
    var xdg = new XdgList(data);
    xdg.attach("app1");
    /*
    $("#btn-applications").bind("tap", function() {
        $.mobile.changePage($("#applications"), {
            'transition': 'slide'
        });
    });
    $("#btn-locations").bind("tap", function() {
        $.mobile.changePage($("#locations"), {
            'transition': 'slide'
        });
    });*/

    console.log($(".ui-mobile-viewport").css('width'));
});

//-->
</script>                                                               
</head>                                                                 
<body>                                                                  
<div data-role="page" id="first">
    <div data-role="header" data-add-back-btn="true">
        <h1>Favorites</h1>
    </div><!-- /header -->

    <div data-role="content">   
    <ul data-role="listview">
        <li> <a href="#applications" data-transition="slide" id="btn-applications">Applications</a> </li>
        <li> <a href="#locations" data-transition="slide" id="btn-locations">Locations</a> </li>
        <li> <a href="" id="btn-locations">Settings</a></li>
        <li> <a href="" id="btn-locations">Log Out</a></li>
        <li> <a href="" id="btn-locations">Shut Down</a></li>
    </ul>
    </div><!-- /content -->
</div><!-- /page -->

<div data-role="page" id="applications">
    <div data-role="header" data-add-back-btn="true">
        <h1>Applications</h1>
    </div><!-- /header -->

    <div data-role="content">   
        <div id="app1" data-role="collapsible-set"></div>
    </div><!-- /content -->
</div><!-- /page -->

<div data-role="page" id="locations">
    <div data-role="header" data-add-back-btn="true">
        <h1>Locations</h1>
    </div><!-- /header -->

    <div data-role="content">   
    </div><!-- /content -->
</div><!-- /page -->

</body>                                                                 
</html>
